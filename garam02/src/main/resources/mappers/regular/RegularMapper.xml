<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.garam.web.regular.mapper.RegularMapper">

	<sql id="regularColumns">
		regseq, ctmno, conum, regstartd, regendd, regcompany,
		regaddress, regperson, regphone, regcontract, regmoney,
		regmemo,
		regtrash
	</sql>

	<select id="selctRegular"
		parameterType="com.garam.web.regular.dto.RegularDTO"
		resultType="com.garam.web.regular.dto.RegularDTO">
		SELECT

		*

		FROM

		regular

		<where>
			<if test="regcompany != null">OR regcompany Like CONCAT('%',#{regcompany},'%') </if>
		</where>
	</select>

	<select id="selctRegularInfo"
		parameterType="com.garam.web.regular.dto.RegularDTO"
		resultType="com.garam.web.regular.dto.RegularDTO">
		SELECT

		*

		FROM

		regular

		LEFT JOIN

		customer

		ON

		regular.ctmno =
		customer.ctmno

		WHERE

		conum = #{conum}
	</select>

	<select id="selectRegulardetail"
		parameterType="com.garam.web.regular.dto.RegularDTO"
		resultType="com.garam.web.regular.dto.RegularDTO">

		SELECT

		rdseq, conum, codenum, rdname, rdbus, opercar,
		rdmoney, rdaltm, rddow, rdmemo, rdtrash, rdconn,
		rdnum,

		IFNULL((SELECT
		employeeinfo.name FROM
		employeeinfo WHERE
		employeeinfo.id
		=
		(SELECT id
		FROM vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar)),
		regulardetail.opercar)
		AS idname,

		IFNULL((SELECT
		employeeinfo.phone1 FROM
		employeeinfo WHERE
		employeeinfo.id =
		(SELECT id FROM vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar)),
		regulardetail.opercar)
		AS idphone1,

		IFNULL((SELECT
		vehicleinfo.vehicle FROM
		vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar),
		regulardetail.opercar) AS
		idvehicle

		FROM

		regulardetail

		WHERE

		conum = #{conum}

		ORDER BY rdnum

	</select>

	<select id="selectRegulardetailInfo"
		parameterType="com.garam.web.regular.dto.RegularDTO"
		resultType="com.garam.web.regular.dto.RegularDTO">

		SELECT

		rdseq, conum, codenum, rdname, rdbus, opercar,
		rdmoney, rdaltm, rddow, rdmemo, rdtrash, rdconn,
		rdnum,

		IFNULL((SELECT
		employeeinfo.name FROM
		employeeinfo WHERE
		employeeinfo.id
		=
		(SELECT id
		FROM vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar)),
		regulardetail.opercar)
		AS idname,

		IFNULL((SELECT
		employeeinfo.phone1 FROM
		employeeinfo WHERE
		employeeinfo.id =
		(SELECT id FROM vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar)),
		regulardetail.opercar)
		AS idphone1,

		IFNULL((SELECT
		vehicleinfo.vehicle FROM
		vehicleinfo WHERE
		vehicleinfo.carnumber
		=
		regulardetail.opercar),
		regulardetail.opercar) AS
		idvehicle

		FROM

		regulardetail

		WHERE

		codenum = #{codenum}

		ORDER BY rdnum

	</select>

	<select id="selectRegularcourse"
		parameterType="com.garam.web.regular.dto.RegularDTO"
		resultType="com.garam.web.regular.dto.RegularDTO">

		SELECT

		*

		FROM

		regularcourse

		WHERE

		codenum = #{codenum}

		ORDER BY
		rct, goutnum, rcnum
	</select>

	<insert id="insertRegular"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		INSERT

		INTO

		regular

		VALUES

		(
		null,
		#{ctmno},
		#{conum},
		#{regstartd},
		#{regendd},
		#{regcompany},
		#{regaddress},
		#{regperson},
		#{regphone},
		#{regcontract},
		#{regnum},
		#{regmoney},
		#{regmemo},
		1
		)

	</insert>

	<insert id="insertRegulardetail"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		INSERT

		INTO

		regulardetail

		VALUES

		(
		null,
		#{conum},
		#{codenum},
		100,
		null,
		null,
		null,
		null,
		null,
		null,
		null,
		null,
		1
		);

		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idname},
		1,
		1,
		0,
		'07:00',
		null,
		'출근출발',
		1
		);

		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idphone1},
		1,
		1,
		50,
		'09:00',
		null,
		'도착',
		1
		);

		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idvehicle},
		2,
		2,
		100,
		'18:00',
		null,
		'퇴근출발',
		1
		);
	</insert>

	<insert id="insertRegulardetailGO"
		parameterType="com.garam.web.regular.dto.RegularDTO">
		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idname},
		#{goutnum},
		1,
		0,
		'07:00',
		null,
		'출근출발',
		1
		);

		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idphone1},
		#{goutnum},
		1,
		50,
		'09:00',
		null,
		'도착',
		1
		);
	</insert>

	<insert id="insertRegulardetailOUT"
		parameterType="com.garam.web.regular.dto.RegularDTO">
		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{idname},
		#{goutnum},
		2,
		100,
		'18:00',
		null,
		'퇴근출발',
		1
		);
	</insert>

	<insert id="insertRegularCoo"
		parameterType="com.garam.web.regular.dto.RegularDTO">
		INSERT

		INTO

		regularcourse

		VALUES

		(
		null,
		#{codenum},
		#{coconum},
		#{goutnum},
		#{rcsepa},
		#{rcnum},
		#{rct},
		null,
		null,
		1
		);
	</insert>

	<update id="updateRegulardetail"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		UPDATE

		regulardetail

		SET

		<if test="rdname != null">rdname = #{rdname},</if>
		<if test="rdbus != null">rdbus = #{rdbus},</if>
		<if test="rdconn != null">rdconn = #{rdconn},</if>
		<if test="rdmoney != null">rdmoney = #{rdmoney},</if>
		<if test="rdaltm != null">rdaltm = #{rdaltm},</if>
		<if test="rddow != null">rddow = #{rddow},</if>
		<if test="rdmemo != null">rdmemo = #{rdmemo},</if>
		<if test="opercar != null">opercar = #{opercar},</if>
		rdtrash = #{rdtrash}

		WHERE

		codenum = #{codenum}

	</update>

	<update id="updateRegularcourse"
		parameterType="java.util.HashMap">
		<foreach collection="regco" item="value" index="index"
			separator=";">
			UPDATE

			regularcourse

			SET

			<if test="value.goutnum != null">goutnum = #{value.goutnum},</if>
			<if test="value.rcsepa != null">rcsepa = #{value.rcsepa},</if>
			<if test="value.rcnum != null">rcnum = #{value.rcnum},</if>
			<if test="value.rct != null">rct = #{value.rct},</if>
			<if test="value.rcstp != null">rcstp = #{value.rcstp},</if>
			<if test="value.rcmemo != null">rcmemo = #{value.rcmemo},</if>
			rctrash = #{value.rctrash}

			WHERE

			rcseq = #{value.rcseq}
		</foreach>
	</update>


	<update id="delOperCar"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		UPDATE

		regulardetail

		SET

		opercar = null

		WHERE

		codenum =
		#{codenum}

	</update>

	<update id="updateRegulardetailOder"
		parameterType="java.util.HashMap">
		<foreach collection="rde" item="value" index="index"
			separator=";">
			UPDATE

			regulardetail

			SET

			rdnum = #{value.rdnum}

			WHERE

			codenum =
			#{value.codenum}
		</foreach>
	</update>

	<delete id="delRegulardetail"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		DELETE

		FROM

		regulardetail

		WHERE

		codenum = #{codenum}
	</delete>

	<delete id="delRegularCoo"
		parameterType="com.garam.web.regular.dto.RegularDTO">

		DELETE

		FROM

		regularcourse

		<where>
			<if test="rcseq != null">AND rcseq = #{rcseq}
			</if>
			<if test="codenum != null">AND codenum = #{codenum}
			</if>
			<if test="goutnum != null">AND goutnum = #{goutnum}
			</if>
		</where>
	</delete>
</mapper>

